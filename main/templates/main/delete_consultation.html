{% extends 'main/base.html' %}
{% load static %}

{% block content %}

<section class="section">
  <div class="container">
    <h2 class="text-center" style="margin-bottom: 30px;">Delete Consultation</h2>

    <div style="max-width:600px;margin:0 auto;background:#f7f7f7;padding:30px;border-radius:10px;">
      <div style="background:#fff3cd;border:1px solid #ffc107;padding:15px;border-radius:5px;margin-bottom:20px;">
        <strong>Warning:</strong> Are you sure you want to delete this consultation? This action cannot be undone.
      </div>

      <div style="background:#fff;padding:20px;border-radius:5px;margin-bottom:20px;">
        <p><strong>Name:</strong> {{ consultation.name }}</p>
        <p><strong>Email:</strong> {{ consultation.email }}</p>
        <p><strong>Phone:</strong> {{ consultation.phone }}</p>
        <p><strong>Service:</strong> {{ consultation.service }}</p>
        <p><strong>Preferred Date:</strong> {{ consultation.appointment_date|date:"F d, Y" }}</p>
        <p><strong>Submitted At:</strong> {{ consultation.submitted_at|date:"F d, Y g:i A" }}</p>
      </div>

      <form method="post" id="deleteForm" style="text-align:center;">
        {% csrf_token %}
        <button type="submit" style="background:#cc0000;color:#fff;padding:12px 30px;border:none;border-radius:5px;cursor:pointer;font-size:16px;margin-right:10px;">Yes, Delete</button>
        <a href="{% url 'dashboard' %}" style="background:#999;color:#fff;padding:12px 30px;text-decoration:none;border-radius:5px;display:inline-block;">Cancel</a>
      </form>

    </div>

  </div>
</section>

{% endblock %}

{% block extra_js %}
<script>
(function() {
    'use strict';
    
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    
    const form = document.getElementById('deleteForm');
    if (form) {
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!confirm('Are you absolutely sure you want to delete this consultation? This action cannot be undone.')) {
                return;
            }
            
            const csrftoken = getCookie('csrftoken') || document.querySelector('[name=csrfmiddlewaretoken]')?.value;
            const formData = new FormData(form);
            const submitButton = form.querySelector('button[type="submit"]');
            const originalText = submitButton ? submitButton.textContent : 'Yes, Delete';
            
            if (submitButton) {
                submitButton.disabled = true;
                submitButton.textContent = 'Deleting...';
            }
            
            try {
                const response = await fetch(window.location.href, {
                    method: 'POST',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                        'X-CSRFToken': csrftoken || ''
                    },
                    body: formData,
                    credentials: 'same-origin'
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error('Network response was not ok: ' + response.status);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    alert(result.message);
                    window.location.href = '{% url "dashboard" %}';
                } else {
                    alert('Error: ' + (result.message || 'Unknown error occurred'));
                }
            } catch (error) {
                console.error('Submission error:', error);
                // Fallback to regular form submission
                form.submit();
            } finally {
                if (submitButton) {
                    submitButton.disabled = false;
                    submitButton.textContent = originalText;
                }
            }
        });
    }
})();
</script>
{% endblock %}




