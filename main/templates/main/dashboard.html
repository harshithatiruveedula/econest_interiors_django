{% extends 'main/base.html' %}
{% load static %}

{% block title %}Admin Dashboard - EcoNest Interiors{% endblock %}

{% block content %}

<!-- HERO SECTION (matching other pages exactly) -->
<section class="page-hero">
  <div class="container grid hero-grid">
    <div>
      <h1>Admin Dashboard</h1>
      <p>Manage consultations and view statistics</p>
    </div>
    <div class="hero-media">
      <img src="{% static 'main/images/img35.jpg' %}" alt="Dashboard hero" />
    </div>
  </div>
</section>

<!-- STATISTICS SECTION -->
<section class="section">
  <div class="container">
    <h2 class="center">Overview</h2>
    <div class="grid cards-3" style="grid-template-columns: repeat(4, 1fr);">
      <article class="card">
        <h3>Total Bookings</h3>
        <p style="font-size:32px;font-weight:bold;color:var(--green);margin:10px 0;">{{ total_bookings }}</p>
      </article>
      <article class="card">
        <h3>Total Services</h3>
        <p style="font-size:32px;font-weight:bold;color:var(--green);margin:10px 0;">{{ total_services }}</p>
      </article>
      <article class="card">
        <h3>Gallery Images</h3>
        <p style="font-size:32px;font-weight:bold;color:var(--green);margin:10px 0;">{{ total_images }}</p>
      </article>
      <article class="card">
        <h3>Blog Posts</h3>
        <p style="font-size:32px;font-weight:bold;color:var(--green);margin:10px 0;">{{ total_posts }}</p>
      </article>
    </div>
  </div>
</section>

<!-- CONSULTATIONS MANAGEMENT SECTION -->
<section class="section alt">
  <div class="container">
    <!-- Header with Create Button -->
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;flex-wrap:wrap;gap:20px;">
      <h2 style="margin:0;">All Consultations ({{ all_bookings|length }})</h2>
      <a href="{% url 'create_consultation' %}" class="button primary" style="font-size:16px;padding:12px 24px;">+ Create New Consultation</a>
    </div>

    <!-- Messages -->
    {% if messages %}
    <div style="margin-bottom:20px;">
      {% for message in messages %}
      <div style="padding:12px;margin-bottom:10px;border-radius:5px; 
                  {% if message.tags == 'error' %}background:#fee;border:1px solid #fcc;color:#c33;
                  {% elif message.tags == 'warning' %}background:#ffc;border:1px solid #fc9;color:#963;
                  {% else %}background:#efe;border:1px solid #cfc;color:#363;{% endif %}">
        {{ message }}
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <!-- SEARCH AND FILTER FORM -->
    <form method="get" action="{% url 'dashboard' %}" style="background:#fff;padding:20px;border-radius:12px;margin-bottom:30px;box-shadow:0 2px 4px rgba(0,0,0,0.1);">
      <div class="grid" style="grid-template-columns:2fr 1fr 1fr 1fr auto;gap:15px;align-items:end;">
        <div class="form-field">
          <label for="search">Search</label>
          <input type="text" id="search" name="search" value="{{ search_query }}" placeholder="Search by name, email, phone, or service..." />
        </div>
        <div class="form-field">
          <label for="service">Filter by Service</label>
          <select id="service" name="service">
            <option value="">All Services</option>
            {% for service in unique_services %}
            <option value="{{ service }}" {% if filter_service == service %}selected{% endif %}>{{ service }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="form-field">
          <label for="date_from">Date From</label>
          <input type="date" id="date_from" name="date_from" value="{{ filter_date_from }}" />
        </div>
        <div class="form-field">
          <label for="date_to">Date To</label>
          <input type="date" id="date_to" name="date_to" value="{{ filter_date_to }}" />
        </div>
        <div class="form-field" style="display:flex;gap:10px;flex-direction:column;">
          <button type="submit" class="button primary" style="width:100%;">Search</button>
          <a href="{% url 'dashboard' %}" class="button" style="background:#6c757d;color:#fff;padding:12px 18px;border-radius:8px;text-decoration:none;display:block;text-align:center;">Clear</a>
        </div>
      </div>
    </form>

    <!-- CONSULTATIONS TABLE -->
    <div style="overflow-x:auto;background:#fff;border-radius:12px;box-shadow:0 2px 4px rgba(0,0,0,0.1);padding:20px;">
      <table style="width:100%;border-collapse:collapse;min-width:1000px;">
        <thead>
          <tr style="background:var(--green);color:#fff;">
            <th style="padding:15px;text-align:left;font-weight:600;border:1px solid rgba(255,255,255,0.2);">ID</th>
            <th style="padding:15px;text-align:left;font-weight:600;border:1px solid rgba(255,255,255,0.2);">Name</th>
            <th style="padding:15px;text-align:left;font-weight:600;border:1px solid rgba(255,255,255,0.2);">Email</th>
            <th style="padding:15px;text-align:left;font-weight:600;border:1px solid rgba(255,255,255,0.2);">Phone</th>
            <th style="padding:15px;text-align:left;font-weight:600;border:1px solid rgba(255,255,255,0.2);">Service</th>
            <th style="padding:15px;text-align:left;font-weight:600;border:1px solid rgba(255,255,255,0.2);">Preferred Date</th>
            <th style="padding:15px;text-align:left;font-weight:600;border:1px solid rgba(255,255,255,0.2);">Submitted At</th>
            <th style="padding:15px;text-align:center;font-weight:600;min-width:200px;border:1px solid rgba(255,255,255,0.2);">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for b in all_bookings %}
          <tr style="border-bottom:1px solid #e5e7eb;transition:background 0.2s;">
            <td style="padding:15px;border:1px solid #e5e7eb;">{{ b.id }}</td>
            <td style="padding:15px;border:1px solid #e5e7eb;font-weight:500;">{{ b.name }}</td>
            <td style="padding:15px;border:1px solid #e5e7eb;"><a href="mailto:{{ b.email }}" style="color:#0066cc;text-decoration:none;">{{ b.email }}</a></td>
            <td style="padding:15px;border:1px solid #e5e7eb;"><a href="tel:{{ b.phone }}" style="color:#0066cc;text-decoration:none;">{{ b.phone }}</a></td>
            <td style="padding:15px;border:1px solid #e5e7eb;">{{ b.service }}</td>
            <td style="padding:15px;border:1px solid #e5e7eb;color:#0066cc;font-weight:bold;">
              {% if b.appointment_date %}
                {{ b.appointment_date|date:"F d, Y" }}
              {% else %}
                <span style="color:#999;">Not specified</span>
              {% endif %}
            </td>
            <td style="padding:15px;border:1px solid #e5e7eb;color:#666;font-size:14px;">{{ b.submitted_at|date:"M d, Y g:i A" }}</td>
            <td style="padding:15px;border:1px solid #e5e7eb;text-align:center;">
              <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap;align-items:center;">
                <a href="{% url 'edit_consultation' b.id %}" 
                   style="background:#0066cc !important;color:#fff !important;padding:10px 20px !important;font-size:14px !important;text-decoration:none !important;border-radius:6px !important;font-weight:600 !important;display:inline-block !important;min-width:80px !important;text-align:center !important;transition:all 0.2s !important;box-shadow:0 2px 4px rgba(0,102,204,0.3) !important;"
                   onmouseover="this.style.background='#0052a3' !important;this.style.transform='scale(1.05)' !important;this.style.boxShadow='0 4px 8px rgba(0,102,204,0.4)' !important;" 
                   onmouseout="this.style.background='#0066cc' !important;this.style.transform='scale(1)' !important;this.style.boxShadow='0 2px 4px rgba(0,102,204,0.3)' !important;">‚úèÔ∏è Edit</a>
                <a href="{% url 'delete_consultation' b.id %}" 
                   style="background:#dc3545 !important;color:#fff !important;padding:10px 20px !important;font-size:14px !important;text-decoration:none !important;border-radius:6px !important;font-weight:600 !important;display:inline-block !important;min-width:80px !important;text-align:center !important;transition:all 0.2s !important;box-shadow:0 2px 4px rgba(220,53,69,0.3) !important;"
                   onmouseover="this.style.background='#c82333' !important;this.style.transform='scale(1.05)' !important;this.style.boxShadow='0 4px 8px rgba(220,53,69,0.4)' !important;" 
                   onmouseout="this.style.background='#dc3545' !important;this.style.transform='scale(1)' !important;this.style.boxShadow='0 2px 4px rgba(220,53,69,0.3)' !important;"
                   onclick="return confirm('Are you sure you want to delete this consultation? This action cannot be undone.');">üóëÔ∏è Delete</a>
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="8" style="padding:60px;text-align:center;color:#666;border:1px solid #e5e7eb;">
              <p style="margin:0;font-size:18px;font-weight:500;">No consultations found</p>
              <p style="margin:10px 0 0 0;font-size:14px;color:#999;">
                {% if search_query or filter_service or filter_date_from or filter_date_to %}
                  Try adjusting your search or filter criteria.
                {% else %}
                  Consultations will appear here once customers submit the form.
                {% endif %}
              </p>
              {% if not search_query and not filter_service and not filter_date_from and not filter_date_to %}
              <a href="{% url 'create_consultation' %}" class="button primary" style="margin-top:20px;display:inline-block;">Create First Consultation</a>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</section>

{% endblock %}

{% block extra_css %}
<style>
  /* Dashboard specific styles */
  .dashboard-filters .grid {
    grid-template-columns: 2fr 1fr 1fr 1fr auto;
  }
  
  @media (max-width: 900px) {
    .dashboard-filters .grid {
      grid-template-columns: 1fr;
    }
    .grid.cards-3[style*="grid-template-columns: repeat(4"] {
      grid-template-columns: repeat(2, 1fr) !important;
    }
  }
  
  @media (max-width: 640px) {
    .grid.cards-3[style*="grid-template-columns: repeat(4"] {
      grid-template-columns: 1fr !important;
    }
    table {
      font-size: 13px;
    }
    table th,
    table td {
      padding: 10px 8px;
    }
  }
  
  /* Table row hover effect */
  tbody tr:hover {
    background: #f9fafb !important;
  }
  
  /* Button styles for CRUD operations */
  .button {
    transition: all 0.2s ease;
  }
  
  .button:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
  }
</style>
{% endblock %}
