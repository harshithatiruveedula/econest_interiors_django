{% extends 'main/base.html' %}
{% load static %}

{% block title %}Admin Dashboard - EcoNest Interiors{% endblock %}

{% block content %}

<!-- DASHBOARD HEADER (No hero image, professional design) -->
<section class="section" style="background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);color:#fff;padding:60px 0;">
  <div class="container">
    <div style="text-align:center;">
      <h1 style="font-size:42px;font-weight:700;margin-bottom:15px;color:#fff;">Admin Dashboard</h1>
      <p style="font-size:18px;opacity:0.9;">Manage consultations and view statistics</p>
    </div>
  </div>
</section>

<!-- STATISTICS SECTION -->
<section class="section">
  <div class="container">
    <h2 class="center" style="margin-bottom:40px;">Overview</h2>
    <div class="grid cards-3" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));gap:25px;">
      <article class="card" style="background:#fff;padding:30px;border-radius:12px;box-shadow:0 4px 6px rgba(0,0,0,0.1);text-align:center;transition:transform 0.3s;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
        <h3 style="color:#666;font-size:16px;margin-bottom:15px;text-transform:uppercase;letter-spacing:1px;">Total Bookings</h3>
        <p style="font-size:48px;font-weight:bold;color:var(--green);margin:0;">{{ total_bookings }}</p>
      </article>
      <article class="card" style="background:#fff;padding:30px;border-radius:12px;box-shadow:0 4px 6px rgba(0,0,0,0.1);text-align:center;transition:transform 0.3s;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
        <h3 style="color:#666;font-size:16px;margin-bottom:15px;text-transform:uppercase;letter-spacing:1px;">Total Services</h3>
        <p style="font-size:48px;font-weight:bold;color:var(--green);margin:0;">{{ total_services }}</p>
      </article>
      <article class="card" style="background:#fff;padding:30px;border-radius:12px;box-shadow:0 4px 6px rgba(0,0,0,0.1);text-align:center;transition:transform 0.3s;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
        <h3 style="color:#666;font-size:16px;margin-bottom:15px;text-transform:uppercase;letter-spacing:1px;">Gallery Images</h3>
        <p style="font-size:48px;font-weight:bold;color:var(--green);margin:0;">{{ total_images }}</p>
      </article>
      <article class="card" style="background:#fff;padding:30px;border-radius:12px;box-shadow:0 4px 6px rgba(0,0,0,0.1);text-align:center;transition:transform 0.3s;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
        <h3 style="color:#666;font-size:16px;margin-bottom:15px;text-transform:uppercase;letter-spacing:1px;">Blog Posts</h3>
        <p style="font-size:48px;font-weight:bold;color:var(--green);margin:0;">{{ total_posts }}</p>
      </article>
    </div>
  </div>
</section>

<!-- CONSULTATIONS MANAGEMENT SECTION -->
<section class="section alt">
  <div class="container">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;flex-wrap:wrap;gap:20px;">
      <h2 style="margin:0;color:#333;">All Consultations ({{ all_bookings|length }})</h2>
      <a href="{% url 'create_consultation' %}" class="button primary" style="padding:12px 24px;font-size:16px;font-weight:600;text-decoration:none;border-radius:8px;display:inline-flex;align-items:center;gap:8px;">
        <span>+</span> Create New Consultation
      </a>
    </div>

    {% if messages %}
    <div style="margin-bottom:25px;">
      {% for message in messages %}
      <div style="padding:15px;margin-bottom:10px;border-radius:8px;background:{% if message.tags == 'error' %}#f8d7da{% elif message.tags == 'warning' %}#fff3cd{% else %}#d4edda{% endif %};color:{% if message.tags == 'error' %}#721c24{% elif message.tags == 'warning' %}#856404{% else %}#155724{% endif %};border:1px solid {% if message.tags == 'error' %}#f5c6cb{% elif message.tags == 'warning' %}#ffeaa7{% else %}#c3e6cb{% endif %};">
        {{ message }}
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <!-- SEARCH AND FILTER FORM -->
    <form method="get" action="{% url 'dashboard' %}" style="background:#fff;padding:25px;border-radius:12px;margin-bottom:30px;box-shadow:0 2px 4px rgba(0,0,0,0.1);">
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:15px;">
        <div>
          <label for="search" style="display:block;margin-bottom:8px;font-weight:600;color:#333;">Search</label>
          <input type="text" id="search" name="search" value="{{ search_query }}" placeholder="Name, email, phone, service..." style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-size:14px;" />
        </div>
        <div>
          <label for="service" style="display:block;margin-bottom:8px;font-weight:600;color:#333;">Filter by Service</label>
          <select id="service" name="service" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-size:14px;">
            <option value="">All Services</option>
            {% for service in unique_services %}
            <option value="{{ service }}" {% if filter_service == service %}selected{% endif %}>{{ service }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label for="date_from" style="display:block;margin-bottom:8px;font-weight:600;color:#333;">Date From</label>
          <input type="date" id="date_from" name="date_from" value="{{ filter_date_from }}" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-size:14px;" />
        </div>
        <div>
          <label for="date_to" style="display:block;margin-bottom:8px;font-weight:600;color:#333;">Date To</label>
          <input type="date" id="date_to" name="date_to" value="{{ filter_date_to }}" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-size:14px;" />
        </div>
      </div>
      <div style="display:flex;gap:10px;">
        <button type="submit" class="button primary" style="padding:10px 20px;font-size:14px;font-weight:600;border:none;border-radius:6px;cursor:pointer;">Search & Filter</button>
        <a href="{% url 'dashboard' %}" class="button" style="padding:10px 20px;font-size:14px;text-decoration:none;text-align:center;display:inline-flex;align-items:center;justify-content:center;border-radius:6px;background:#6c757d;color:#fff;">Clear Filters</a>
      </div>
    </form>

    <!-- CONSULTATIONS TABLE -->
    <div style="overflow-x:auto;background:#fff;border-radius:12px;box-shadow:0 2px 4px rgba(0,0,0,0.1);">
      <table style="width:100%;border-collapse:collapse;min-width:1000px;">
        <thead>
          <tr style="background:var(--green);color:#fff;">
            <th style="padding:15px;text-align:left;font-weight:600;font-size:14px;text-transform:uppercase;letter-spacing:0.5px;">Name</th>
            <th style="padding:15px;text-align:left;font-weight:600;font-size:14px;text-transform:uppercase;letter-spacing:0.5px;">Email</th>
            <th style="padding:15px;text-align:left;font-weight:600;font-size:14px;text-transform:uppercase;letter-spacing:0.5px;">Phone</th>
            <th style="padding:15px;text-align:left;font-weight:600;font-size:14px;text-transform:uppercase;letter-spacing:0.5px;">Service</th>
            <th style="padding:15px;text-align:left;font-weight:600;font-size:14px;text-transform:uppercase;letter-spacing:0.5px;">Appointment Date</th>
            <th style="padding:15px;text-align:left;font-weight:600;font-size:14px;text-transform:uppercase;letter-spacing:0.5px;">Submitted At</th>
            <th style="padding:15px;text-align:center;font-weight:600;font-size:14px;text-transform:uppercase;letter-spacing:0.5px;">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for b in all_bookings %}
          <tr style="border-bottom:1px solid #e5e7eb;transition:background 0.2s;" onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='#fff'">
            <td style="padding:15px;border:1px solid #e5e7eb;font-weight:500;color:#333;">{{ b.name }}</td>
            <td style="padding:15px;border:1px solid #e5e7eb;color:#666;">{{ b.email }}</td>
            <td style="padding:15px;border:1px solid #e5e7eb;color:#666;">{{ b.phone }}</td>
            <td style="padding:15px;border:1px solid #e5e7eb;color:#666;">{{ b.service }}</td>
            <td style="padding:15px;border:1px solid #e5e7eb;color:#0066cc;font-weight:600;">
              {% if b.appointment_date %}
                {{ b.appointment_date|date:"M d, Y" }}
              {% else %}
                <span style="color:#999;">Not specified</span>
              {% endif %}
            </td>
            <td style="padding:15px;border:1px solid #e5e7eb;color:#666;font-size:13px;">{{ b.submitted_at|date:"M d, Y g:i A" }}</td>
            <td style="padding:15px;border:1px solid #e5e7eb;text-align:center;">
              <div style="display:flex;gap:8px;justify-content:center;flex-wrap:wrap;">
                <a href="{% url 'edit_consultation' b.id %}" class="button" style="background:#0066cc;color:#fff;padding:8px 16px;font-size:13px;text-decoration:none;border-radius:6px;font-weight:500;display:inline-block;min-width:70px;text-align:center;transition:all 0.2s;" onmouseover="this.style.background='#0052a3';this.style.transform='scale(1.05)'" onmouseout="this.style.background='#0066cc';this.style.transform='scale(1)'">Edit</a>
                <a href="{% url 'delete_consultation' b.id %}" class="button" style="background:#dc3545;color:#fff;padding:8px 16px;font-size:13px;text-decoration:none;border-radius:6px;font-weight:500;display:inline-block;min-width:70px;text-align:center;transition:all 0.2s;" onmouseover="this.style.background='#c82333';this.style.transform='scale(1.05)'" onmouseout="this.style.background='#dc3545';this.style.transform='scale(1)'" onclick="return confirm('Are you sure you want to delete this consultation? This action cannot be undone.');">Delete</a>
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7" style="padding:60px;text-align:center;color:#666;">
              <p style="margin:0;font-size:18px;font-weight:500;">No consultations found</p>
              <p style="margin:10px 0 0 0;font-size:14px;color:#999;">
                {% if search_query or filter_service or filter_date_from or filter_date_to %}
                  Try adjusting your search or filter criteria.
                {% else %}
                  Consultations will appear here once customers submit the form.
                {% endif %}
              </p>
              {% if not search_query and not filter_service and not filter_date_from and not filter_date_to %}
              <a href="{% url 'create_consultation' %}" class="button primary" style="margin-top:20px;display:inline-block;padding:12px 24px;text-decoration:none;border-radius:8px;">Create First Consultation</a>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</section>

{% endblock %}

{% block extra_css %}
<style>
  @media (max-width: 768px) {
    .cards-3 {
      grid-template-columns: 1fr !important;
    }
    table {
      font-size: 12px;
    }
    th, td {
      padding: 8px !important;
    }
  }
</style>
{% endblock %}
