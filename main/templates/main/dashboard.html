{% extends 'main/base.html' %}
{% load static %}

{% block title %}Admin Dashboard - EcoNest Interiors{% endblock %}

{% block content %}

<!-- HERO SECTION (matching other pages) -->
<section class="page-hero">
  <div class="container grid hero-grid">
    <div>
      <h1>Admin Dashboard</h1>
      <p>Manage consultations and view statistics</p>
    </div>
    <div class="hero-media">
      <img src="{% static 'main/images/img35.jpg' %}" alt="Dashboard hero" />
    </div>
  </div>
</section>

<!-- STATISTICS SECTION -->
<section class="section">
  <div class="container">
    <h2 class="center">Overview</h2>
    <div class="grid cards-3" style="grid-template-columns: repeat(4, 1fr);">
      <article class="card">
        <h3>Total Bookings</h3>
        <p style="font-size:32px;font-weight:bold;color:var(--green);margin:10px 0;">{{ total_bookings }}</p>
      </article>
      <article class="card">
        <h3>Total Services</h3>
        <p style="font-size:32px;font-weight:bold;color:var(--green);margin:10px 0;">{{ total_services }}</p>
      </article>
      <article class="card">
        <h3>Gallery Images</h3>
        <p style="font-size:32px;font-weight:bold;color:var(--green);margin:10px 0;">{{ total_images }}</p>
      </article>
      <article class="card">
        <h3>Blog Posts</h3>
        <p style="font-size:32px;font-weight:bold;color:var(--green);margin:10px 0;">{{ total_posts }}</p>
      </article>
    </div>
  </div>
</section>

<!-- CONSULTATIONS MANAGEMENT SECTION -->
<section class="section alt">
  <div class="container">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;flex-wrap:wrap;gap:20px;">
      <h2 style="margin:0;">All Consultations ({{ all_bookings|length }})</h2>
      <a href="{% url 'create_consultation' %}" class="button primary">+ Create New Consultation</a>
    </div>

    {% if messages %}
    <div style="margin-bottom:20px;">
      {% for message in messages %}
      <div style="padding:12px;margin-bottom:10px;border-radius:5px; 
                  {% if message.tags == 'error' %}background:#fee;border:1px solid #fcc;color:#c33;
                  {% elif message.tags == 'warning' %}background:#ffc;border:1px solid #fc9;color:#963;
                  {% else %}background:#efe;border:1px solid #cfc;color:#363;{% endif %}">
        {{ message }}
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <!-- SEARCH AND FILTER FORM -->
    <form method="get" action="{% url 'dashboard' %}" style="background:#fff;padding:20px;border-radius:12px;margin-bottom:30px;box-shadow:0 2px 4px rgba(0,0,0,0.1);" class="dashboard-filters">
      <div class="grid" style="grid-template-columns:2fr 1fr 1fr 1fr auto;gap:15px;align-items:end;" class="filter-grid">
        <div class="form-field">
          <label for="search">Search</label>
          <input type="text" id="search" name="search" value="{{ search_query }}" placeholder="Search by name, email, phone, or service..." />
        </div>
        <div class="form-field">
          <label for="service">Filter by Service</label>
          <select id="service" name="service">
            <option value="">All Services</option>
            {% for service in unique_services %}
            <option value="{{ service }}" {% if filter_service == service %}selected{% endif %}>{{ service }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="form-field">
          <label for="date_from">Date From</label>
          <input type="date" id="date_from" name="date_from" value="{{ filter_date_from }}" />
        </div>
        <div class="form-field">
          <label for="date_to">Date To</label>
          <input type="date" id="date_to" name="date_to" value="{{ filter_date_to }}" />
        </div>
        <div class="form-field" style="display:flex;gap:10px;">
          <button type="submit" class="button primary" style="flex:1;">Search/Filter</button>
          <a href="{% url 'dashboard' %}" class="button" style="background:#6c757d;color:#fff;padding:12px 18px;border-radius:8px;text-decoration:none;display:inline-block;">Clear</a>
        </div>
      </div>
    </form>

    <!-- CONSULTATIONS TABLE -->
    <div style="overflow-x:auto;background:#fff;border-radius:12px;box-shadow:0 2px 4px rgba(0,0,0,0.1);">
      <table style="width:100%;border-collapse:collapse;min-width:1000px;">
        <thead>
          <tr style="background:var(--green);color:#fff;">
            <th style="padding:15px;text-align:left;font-weight:600;">ID</th>
            <th style="padding:15px;text-align:left;font-weight:600;">Name</th>
            <th style="padding:15px;text-align:left;font-weight:600;">Email</th>
            <th style="padding:15px;text-align:left;font-weight:600;">Phone</th>
            <th style="padding:15px;text-align:left;font-weight:600;">Service</th>
            <th style="padding:15px;text-align:left;font-weight:600;">Preferred Date</th>
            <th style="padding:15px;text-align:left;font-weight:600;">Submitted At</th>
            <th style="padding:15px;text-align:center;font-weight:600;min-width:180px;">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for b in all_bookings %}
          <tr style="border-bottom:1px solid #e5e7eb;">
            <td style="padding:15px;">{{ b.id }}</td>
            <td style="padding:15px;font-weight:500;">{{ b.name }}</td>
            <td style="padding:15px;"><a href="mailto:{{ b.email }}" style="color:#0066cc;text-decoration:none;">{{ b.email }}</a></td>
            <td style="padding:15px;"><a href="tel:{{ b.phone }}" style="color:#0066cc;text-decoration:none;">{{ b.phone }}</a></td>
            <td style="padding:15px;">{{ b.service }}</td>
            <td style="padding:15px;color:#0066cc;font-weight:bold;">
              {% if b.appointment_date %}
                {{ b.appointment_date|date:"F d, Y" }}
              {% else %}
                <span style="color:#999;">Not specified</span>
              {% endif %}
            </td>
            <td style="padding:15px;color:#666;font-size:14px;">{{ b.submitted_at|date:"M d, Y g:i A" }}</td>
            <td style="padding:15px;text-align:center;">
              <div style="display:flex;gap:8px;justify-content:center;">
                <a href="{% url 'edit_consultation' b.id %}" class="button" style="background:#0066cc;color:#fff;padding:6px 12px;font-size:13px;text-decoration:none;">Edit</a>
                <a href="{% url 'delete_consultation' b.id %}" class="button" style="background:#dc3545;color:#fff;padding:6px 12px;font-size:13px;text-decoration:none;" 
                   onclick="return confirm('Are you sure you want to delete this consultation? This action cannot be undone.');">Delete</a>
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="8" style="padding:60px;text-align:center;color:#666;">
              <p style="margin:0;font-size:18px;font-weight:500;">No consultations found</p>
              <p style="margin:10px 0 0 0;font-size:14px;color:#999;">
                {% if search_query or filter_service or filter_date_from or filter_date_to %}
                  Try adjusting your search or filter criteria.
                {% else %}
                  Consultations will appear here once customers submit the form.
                {% endif %}
              </p>
              {% if not search_query and not filter_service and not filter_date_from and not filter_date_to %}
              <a href="{% url 'create_consultation' %}" class="button primary" style="margin-top:20px;display:inline-block;">Create First Consultation</a>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</section>

{% endblock %}

{% block extra_css %}
<style>
  .dashboard-filters .filter-grid {
    grid-template-columns: 2fr 1fr 1fr 1fr auto;
  }
  
  @media (max-width: 900px) {
    .dashboard-filters .filter-grid {
      grid-template-columns: 1fr;
    }
    .dashboard-filters .form-field:last-child {
      display: flex;
      gap: 10px;
    }
    .dashboard-filters .form-field:last-child button,
    .dashboard-filters .form-field:last-child a {
      flex: 1;
    }
    .grid.cards-3[style*="grid-template-columns: repeat(4"] {
      grid-template-columns: repeat(2, 1fr) !important;
    }
  }
  
  @media (max-width: 640px) {
    .grid.cards-3[style*="grid-template-columns: repeat(4"] {
      grid-template-columns: 1fr !important;
    }
  }
  
  .dashboard-table-container {
    overflow-x: auto;
  }
  
  table {
    width: 100%;
  }
  
  @media (max-width: 768px) {
    table {
      font-size: 14px;
    }
    table th,
    table td {
      padding: 10px 8px;
    }
    .action-buttons {
      flex-direction: column;
      gap: 5px;
    }
    .action-buttons .button {
      width: 100%;
      text-align: center;
    }
  }
</style>
{% endblock %}
